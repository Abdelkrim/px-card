<script type="text/javascript">
    (function(){
        window.px = window.px || {};
        //angular implementatio pf px-dealer
        window.px.dealer = {
            getData: function(url) {
                if (window.angular) {
                    //throw 'angular is missing';
                    var $http = angular.element('body').injector().get("$http");

                    return new Promise(function(resolve, reject) {
                        $http.get(url).
                                success(function(data, status, headers, config) {
                                    resolve(data);
                                }).
                                error(function(data, status, headers, config) {
                                    reject(data);
                                });
                    });
                }
            },
            init: function(deckDefintions, decksByClassifications) {
                this.deckDefinitions = deckDefintions;
                this.decksByClassification = decksByClassifications;
            },
            getDecksByClassification: function(dashboardId, classification) {
                var decks = [];
                var self = this;
                if (dashboardId && dashboardId in this.decksByClassification){
                    var decksInDashboard = this.decksByClassification[dashboardId];

                    if (classification in decksInDashboard){
                        decksInDashboard[classification].forEach(function(deckId){
                            if (self.deckDefinitions[deckId]){
                                decks.push(self.deckDefinitions[deckId]);
                            }
                        });
                    }
                }

                return new Promise(function(resolve, reject) {
                    resolve(decks);
                });
            },
            getDeck: function(url){
                return this.getData(url);
            }
        };
    })();
</script>
