<link rel="import" href="../polymer/polymer.html"/>
<dom-module id="px-deck">
    <template>
        <div style="border:blue 3px solid;">
        <content></content>
        </div>
    </template>
</dom-module>
<script>
    window.px = window.px || {};

    px.angularDealer = {
        getData: function(url) {
            var $http = angular.element('body').injector().get("$http");

            return new Promise(function(resolve, reject) {
                $http.get(url).
                    success(function(data, status, headers, config) {
                        resolve(data);
                    }).
                    error(function(data, status, headers, config) {
                        reject(data);
                    });
            });
        }
    };

    Polymer({
        is: 'px-deck',
        created: function(){
            var self = this;
            this.cards = [];
            this.addEventListener('px-card-ready', function(){
                self.debounce('px-card-ready', function(){
                    self.cards = self.findCards();
                    // register cards
                    self.cards.forEach(function(card) {
                        card._dealer = self;
                        card.init(self);
                    });
                }, 10)
            });
        },
        updateState: function(cardId, state) {
            this.cards.forEach(function(card) {
                // only update cards with different ids
                if (card.id !== cardId) {
                    card.deckState = state;
                }
            });
        },
        findCards: function() {
            var content = Polymer.dom(this.root).querySelector('content');
            var cards = [];
            Polymer.dom(content).getDistributedNodes().forEach(function(node) {
                if (node._type && node._type === 'px-card') {
                    cards.push(node);
                }
            });
            return cards;
        },
        detached: function(){
            //this.removeEventListener('px-card-ready');
            //this.cancelDebouncer('px-card-ready');
        }
    });

</script>
