<link rel="import" href="../polymer/polymer.html"/>
<dom-module id="px-dashboard">
    <template>
        <div id="container"></div>
    </template>
</dom-module>
<script>
    window.px = window.px || {};
    px.dealer = px.dealer || {};
    px.dealer.loadedDecks = px.dealer.loadedDecks || {};

    px.dashboard = {
        properties: {
            selectedView: {
                type: String,
                observer: "viewSelected"
            },
            context: {
                type: Object,
                observer: "contextChanged"
            }
        },
        viewSelected: function(newView) {
            if (newView && newView.substring(0, 2) !== '{{') {
                //console.log('new view switch deck', newView);
                this.switchDeck(newView);
            }
        },
        contextChanged: function(newContext) {
            //console.log('NEWCONTEXT', newContext);
            var deck = document.querySelector('px-deck');
            if (deck) {
                deck.context = this.context;
            }
        },
        created: function() {
            //console.log('----> dashboard-created!!');
            this.addEventListener('px-deck-ready', function() {
                //console.log('dashboard received px-deck-ready <----');
                this.fire('px-dashboard-ready');
            });
        },
        ready: function() {
            //console.log('----------> dashboard-ready!!');
        },
        attached: function() {
            //console.log('----> dashboard-attached!!');
        },
        init: function() {
//            console.log('px-dashboard init is called (does nothing)');
//            document.querySelector('px-deck').init();




//
//          $scope.getViewList = function(classification){
//            $scope.decks = [];
//
//            decksByClassification[classification].forEach(function(deckId){
//              $scope.decks.push(viewDefinitions[deckId]);
//            });
//
//            $scope.selectedDeck = $scope.decks[0].url;
//          };
//
//          $scope.getViewList($scope.context.classification);


        },
        switchDeck: function(url) {

            var self = this;
            var container = this.$.container;
            if (container) {
                container.innerHTML = "";
                if (!px.dealer.loadedDecks[url]) {

                    Polymer.Base.importHref(url, function(e) {
                        var deck = e.target.import.body;
                        container.appendChild(deck);
                        px.dealer.loadedDecks[url] = deck;
                        document.querySelector('px-deck').context = self.context;
                    }, function(e) {

                    });
                }
                else {
                    container.appendChild(px.dealer.loadedDecks[url]);
                    document.querySelector('px-deck').context = this.context;
                }
            }
            else {
                console.log('there is no container');
            }
        }
    };

    Polymer({
        is: 'px-dashboard',
        behaviors: [px.dashboard]
    });

</script>
