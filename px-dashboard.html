<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="../iron-ajax/iron-ajax.html"/>

<dom-module id="px-dashboard">
    <template>
        <div id="container"></div>
        <iron-ajax
            auto
            url="{{deckUrl}}"
            handle-as="text"
            on-response="handleResponse"></iron-ajax>
    </template>
</dom-module>
<script>
    window.px = window.px || {};
    px.dealer = px.dealer || {};
    px.dealer.loadedDecks = px.dealer.loadedDecks || {};

    px.dashboard = {
        properties: {
            selectedView: {
                type: String,
                observer: "viewSelected"
            },
            context: {
                type: Object,
                observer: "contextChanged"
            }
        },
        viewSelected: function(newView) {
            if (newView && newView.substring(0, 2) !== '{{') {
                this.switchDeck(newView);
            }
        },
        contextChanged: function(newContext) {
            var deck = this.$.container.querySelector('px-deck');
            if (deck) {
                deck.context = this.context;
            }
        },
        created: function() {
            //console.log('----> dashboard-created!!');
            var self = this;

            this.addEventListener('px-deck-ready', function() {
                //console.log('dashboard received px-deck-ready <----');

                var container = self.$.container;
                container.querySelector('px-deck').context = self.context;

                //this.fire('px-dashboard-ready');
            });
        },
        switchDeck: function(url) {
            var container = this.$.container;
            if (container) {
                container.innerHTML = "";
                this.deckUrl = url;
            }
            else {
                console.log('there is no container');
            }
        },
        handleResponse: function(e) {
            var deck = e.detail.response;
            var container = this.$.container;
            container.innerHTML = deck;
        }
    };

    Polymer({
        is: 'px-dashboard',
        behaviors: [px.dashboard]
    });

</script>
