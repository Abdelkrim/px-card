<link rel="import" href="../polymer/polymer.html"/>

<!--
@blurb px card behavior or card api
-->

<script type="text/javascript">
    //px-card interface/behavior
    (function() {
        window.px = window.px || {};

        window.px.cardBehavior = {
            properties: {
                context: {
                    type: Object,
                    observer: '_contextChanged'
                },
                deckState: {
                    type: Object,
                    observer: '_deckStateChanged'
                }
            },
            _contextChanged: function(newContext, oldContext) {
                if (this.contextChanged && typeof this.contextChanged === 'function') {
                    this.contextChanged(newContext, oldContext);
                }
            },
            _deckStateChanged: function(newDeckState, oldDeckState) {
                this.fromDeck = true;
                if (this.deckStateChanged && typeof this.deckStateChanged === 'function') {
                    this.deckStateChanged(newDeckState, oldDeckState);
                }
                this.fromDeck = false;
            },
            _refresh: function() {
                if (this.refresh && typeof this.refresh === 'function') {
                    this.refresh();
                }
            },
            created: function(){
                this._type = 'px-card';
            },
            ready: function() {
                this.addEventListener('px-card-refresh', this._refresh);
            },
            updateDeck: function(value) {
                if (!this.fromDeck) {
                    if (this.findParentDeck().updateState) {
                        this.findParentDeck().updateState(this.id, value);
                    }
                    else {
                        console.log('no updatestate');
                    }
                }
                else {
                    console.log('KILL this update because from deck');
                }
            },
            findParentDeck: function() {
                var parent = this.parentElement;
                while (parent._type !== 'px-deck' && parent.tagName !== 'BODY'){
                    parent = parent.parentElement;
                }
                if (parent.tagName === 'BODY'){
                    throw new Error('cannot find deck');
                }
                return parent;
            },
            getData: function(url) {
                return this.findParentDeck().getData(url);
            }
        };
    })();
</script>

