<!--
    Relative paths assume component is being run from inside an app or another component, where dependencies are flat
    siblings. When this component is run from its own repo (e.g. ui tests, examples), we assume the server is started with
    'grunt depserve' (or similar server setup) to enable correct finding of bower dependencies for local runs
    See https://github.sw.ge.com/jreichenberg/grunt-dep-serve#why-do-we-need-this
-->
<link rel="import" href="../polymer/polymer.html"/>
<link rel="import" href="px-card-header.html"/>

<!--
Element providing basic styling and behaviors (API) for card

##### Usage

<dom-module id="demo-card">
    <template>
        <px-card>
            <h1>Hello World</h1>
            <p>{{context.name}}</p>
            <p>This is the bare minimum you need for a Predix Experience card.</p>
        </px-card>
    </template>
</dom-module>
<script>
    Polymer({
        is: 'demo-card',
        init: function(){
            // this is where you can do some initialization of your card
        },
        contextChanged: function(newContext, oldContext){
            // this is where you will receive updates to the context
        },
        deckStateChanged: function(newDeckState, oldDeckState){
            // this is where you will receive updates from other cards
        },
        // you can add additional functionality here
        // you may want to use api methods like this.getData, this.updateDeck, this.showCard, this.hideCard
        //    cards/sample-card.html has an example of using updateDeck & deckStateChanged
        //    cards/sample-card.html also has an example of showing the context.name using data binding
        //    cards/fetch-data-card.html has an example of using this.getData
        //    cards/widget-to-widget-card.html has an example of binding widgets together
        //    cards/time-series-card.html has an example of the px-ts-chart widget, getData, and init
        behaviors: [px.card]
    });
</script>

@element px-card
@blurb Element containing basic styling and behaviors (API) for card
@homepage index.html
-->

<dom-module id="px-card">
  <link rel="import" type="css" href="css/px-card.css"/>
  <template>
    <div class="layout__item box box--tiny">
      <px-card-header header-text="Card Header"></px-card-header>
      <content></content>
    </div>
  </template>
</dom-module>

<script type="text/javascript">

    (function() {
        window.px = window.px || {};

        window.px.card = {
            properties: {
                context: {
                    type: Object,
                    observer: '_contextChanged'
                },
                deckState: {
                    type: Object,
                    observer: '_deckStateChanged'
                }
            },
            _contextChanged: function(newContext, oldContext) {
                if (this.contextChanged && typeof this.contextChanged === 'function') {
                    this.contextChanged(newContext, oldContext);
                }
            },
            _deckStateChanged: function(newDealerState, oldDealerState) {
                this.fromDeck = true;
                if (this.deckStateChanged && typeof this.deckStateChanged === 'function') {
                    this.deckStateChanged(newDealerState, oldDealerState);
                }
                this.fromDeck = false;
            },
            _refresh: function() {
                if (this.refresh && typeof this.refresh === 'function') {
                    this.refresh();
                }
            },
            created: function() {
                //console.log('----> card-created!!');
            },
            ready: function() {
                this.addEventListener('px-card-refresh', this._refresh);
                //console.log('----------> card-ready!!');

            },
            attached: function(){
                //console.log('----> card-attached!!');
                this.fire('px-card-ready');
                if (!this.id){
                    throw 'Card ' + this.tagName + ' cannot be created without an id!';
                }
            },
            init: function() {
                // this default init function is needed in case they don't implement init
                // this is the 'instantiate' requirement
                //console.log('px-card init is called');
            },
            updateDeck: function(value) {
                if (!this.fromDeck) {
                    if (this._deck && this._deck.updateState) {
                        this._deck.updateState(this.id, value);
                    }
                    else {
                        //console.log('no updatestate');
                    }
                }
                else {
                    //console.log('KILL this update because from deck');
                }
            },
            showCard: function() {
                this.hidden = false;
                this.querySelector('px-card').hidden = false;
            },
            hideCard: function() {
                this.hidden = true;
                this.querySelector('px-card').hidden = true;
            },
            getData: function(url) {
                return window.px.dealer.getData(url);
            }
        };
    })();

    Polymer({
      is: 'px-card',
//      behaviors: [px.card],
      attached: function(){
        this.toggleClass('layout');
        this.toggleClass('m--');
      }
    });

</script>
